<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">  
    <meta name="_csrf_header" th:content="${_csrf.headerName}"> 
    <title>ログ詳細画面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div th:replace="~{fragments/header :: header('ログ詳細画面')}"></div>
    <div class="detail-bg">
        <div class="detail-box">
            <h2 class="detail-title">通話ログ詳細</h2>
            <p>表示期間: <span th:text="${startDate}"></span> ～ <span th:text="${endDate}"></span></p>
            <div class="table-responsive">
                <table class="table table-hover align-middle"><!--table-hoverはCSSで上書き済み、align-middleはセル内の縦方向のテキストを中央揃えにするスタイル-->
					<thead>
    					<tr th:if="${userRole == 'ROLE_USER'}">
        					<th>通話日時</th>
        					<th>ファイル名</th>
        					<th>操作</th>
    					</tr>
    					<tr th:if="${userRole != 'ROLE_USER'}">
        					<th>通話日時</th>
        					<th>ファイル名</th>
        					<th>ファイルパス</th>
        					<th>作成日時</th>
        					<th>更新日時</th>
        					<th>操作</th>
        					<th>ステータス</th>
    					</tr>
					</thead>
					<tbody>
    					<tr th:each="log : ${callLogs}" th:if="${userRole == 'ROLE_USER'}">
        					<td th:text="${log.callDate}"></td>
        					<td th:text="${log.fileName}"></td>
        					<td>
            					<button type="button" class="btn btn-primary btn-sm btn-play"
                    				th:onclick="'playVideo(\'video-' + ${log.id} + '\')'"><!--再生ボタンカラー・サイズはCSSで上書き済み-->
                					再生
            					</button>
        					</td>
    					</tr>
    					<tr th:each="log : ${callLogs}" th:if="${userRole != 'ROLE_USER'}">
        					<td th:text="${log.callDate}"></td>
        					<td th:text="${log.fileName}"></td>
        					<td th:text="${log.filePath}"></td>
        					<td th:text="${log.createdAt}"></td>
        					<td th:text="${log.updatedAt}"></td>
        					<td>
    							<button type="button" class="btn btn-primary btn-sm btn-play"
            						th:onclick="'playVideo(\'video-' + ${log.id} + '\')'"><!--再生ボタンカラー・サイズはCSSで上書き済み-->
        							再生
    							</button>
    							<video th:id="'video-' + ${log.id}" style="display:none;">
        							<source th:src="@{${log.filePath}}" type="video/mp4">
    							</video>
    							<span th:if="${#strings.endsWith(log.filePath, '.txt')}"
          							th:text="${log.filePath}"></span>
							</td>
							<td>
    							<button th:if="${userRole == 'ROLE_CONFIRM'}"
           	 						class="btn btn-warning btn-sm btn-role btn-role-confirm"
            						th:id="'kakunin-' + ${log.id}"
            						th:disabled="${log.statusKakunin == 1}"
            						th:onclick="'toggleStatus(this, ' + ${log.id} + ', \'kakunin\')'"><!--確認者ボタンカラー・サイズはCSSで上書き済み-->
        							確認者
    							</button>
    							<button th:if="${userRole == 'ROLE_ADMIN'}"
            						class="btn btn-danger btn-sm btn-role btn-role-admin"
            						th:id="'kanri-' + ${log.id}"
            						th:disabled="${log.statusKanri == 1}"
            						th:onclick="'toggleStatus(this, ' + ${log.id} + ', \'kanri\')'"><!--管理者ボタンカラー・サイズはCSSで上書き済み-->
        							管理者
    							</button>
							</td>
							</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<footer class="footer">
    <p>©︎ 2025 コールセンターシステム</p>
	</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="/js/detail.js"></script>
</body>
</html>

